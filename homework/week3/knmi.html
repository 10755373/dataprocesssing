<!-- Rinus van Grunsven; 10755373; Analyse van de etmaalgemiddelde relatieve vochtigheid (in procenten) in De Bilt -->

<!DOCTYPE html>
  <html>
    <head>
      <title>Rinus van Grunsven; 10755373; Etmaalgemiddelde relatieve vochtigheid (in procenten) van 01-01-2018 t/m 01-01-2019</title>
        </head>
          <body>
            <h1>My First Heading</h1>
            <p>My first paragraph.</p>
            <hr>
            <h2>Inhoud</h2>
            <canvas id="graph" width="800" height="800"></canvas>
            <script>
              var fileName = "KNMI_20190101.json";
              var txtFile = new XMLHttpRequest();
              txtFile.onreadystatechange = function() {
                  if (txtFile.readyState === 4 && txtFile.status == 200) {
                      var obj = (JSON.parse(txtFile.responseText));
                      // let keys = Object.keys(obj.bpi)
                      // for (let i = 0; i < keys.length; i++) {
                      //   let item = obj.bpi[i]
                      // };
                      dag = []
                      lucht_v = []
                      var values = (Object.values(obj))
                      console.log(values)
                      values.forEach(function(d){dag.push(d.Datum);
                      });
                      values.forEach(function(d){lucht_v.push(Number(d.Luchtvochtigheid, 10));
                      });
                      console.log(dag);
                      console.log(lucht_v);
                      console.log(typeof(dag));
                      console.log(typeof(lucht_v));

                      // function parseData(data) {
                      // var arr = [];
                      // for (var i in data.bpi) {
                      //     arr.push(
                      //        {
                      //           date: new Date(i), //date
                      //           value: +data.bpi[i] //convert string to number
                      //        });
                      //  }
                      //  return arr;
                      //   }

                      // Transform datum to the right format
                      var dag = new Date("January 1, 2018 00:00:00");
                      console.log(dag.getTime());

                      // calculate min and max
                      dag_min_max = []
                      var dag_min = Math.min(dag)
                      dag_min_max.push(dag_min)
                      var dag_max = Math.max(dag)
                      dag_min_max.push(dag_max)
                      lucht_min_max = []
                      var lucht_v_min = Math.min(lucht_v)
                      lucht_min_max.push(lucht_v_min)
                      var lucht_v_max = Math.max(lucht_v)
                      lucht_min_max.push(lucht_v_max)
                      console.log(dag_min_max);
                      console.log(lucht_min_max);

                      var x_range = [0, 800]
                      var y_range = [0, 800]

                      // Use javascript variables
                      // var graph;
                      // var xPadding = 50;
                      // var yPadding = 50;
                      // var data = { values: [{X: dag, Y: lucht_v}]};

                      // // Set properties to the context
                      // ctx.lineWidth = 2;
                      // ctx.strokeStyle = '#333';
                      // ctx.font = 'italic 8pt sans-serif';
                      // ctx.textAlign = "center";

                      // // use fuction createTransform
                      var x = (createTransform(dag_min_max, x_range));
                      var y = (createTransform(lucht_min_max, y_range));
                      console.log(x);
                      console.log(y);

                      // // Get the Canvas context
                      var graph_id = document.getElementById("graph");
                      var ctx = graph_id.getContext("2d");
                      ctx.rect(0, 0, 800, 800)
                      ctx.stroke();

                      // // Draw the graph
                      ctx.beginPath();
                      ctx.moveTo(dag[0], lucht_v[0]);
                      for(var i = 0; i < lucht_v.length; i ++) {
                          ctx.lineTo(x(dag[i]), y(lucht_v[i]));
                      }
                      ctx.stroke();

                      function createTransform(domain, range){
                    	// domain is a two-element array of the data bounds [domain_min, domain_max]
                    	// range is a two-element array of the screen bounds [range_min, range_max]
                    	// this gives you two equations to solve:
                    	// range_min = alpha * domain_min + beta
                    	// range_max = alpha * domain_max + beta
                     		// a solution would be:

                        var domain_min = domain[0]
                        var domain_max = domain[1]
                        var range_min = range[0]
                        var range_max = range[1]

                        // formulas to calculate the alpha and the beta
                       	var alpha = (range_max - range_min) / (domain_max - domain_min)
                        var beta = range_max - alpha * domain_max

                        // returns the function for the linear transformation (y= a * x + b)
                        return function(x){
                          return alpha * x + beta;
                        }
                    }
                  }
              }
              txtFile.open("GET", fileName);
              txtFile.send();
            </script>
            <h3>deel 2</h3>
            <p> deel 2 </p>

            <p>Take a look at <a href="KNMI_20190101.json" target="_blank">KNMI_20190101.json</a></p>
            <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"></canvas>

    </body>
  </html>
